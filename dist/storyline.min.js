/*! 
 * jQuery Storyline v0.0.1
 * https://markjivko.com/storyline/
 * Copyright (c) 2013 Mark Jivko
 */
jQuery&&jQuery.extend({storyline:function(e){var t=jQuery,r={},o={error:{},status:{},const:{}},n={debug:"debug",info:"info",error:"error"},a=t.extend({frames:{},frameTop:0,guide:!1,buildMenu:!1,menuSpeed:1500,tolerance:20,ignoreWarnings:!0,scrollIntoView:!1,logLevel:n.debug},e),i={body:t("body"),holder:null};o.error.singleton="Singleton. The storyline method can only be used once.",o.error.frames="The <frames> option must be an object.",o.error.guide="The <guide> option must be a boolean.",o.error.tolerance="The <tolerance> option must be an integer.",o.error.buildMenu="The <buildMenu> option must be either false or an array.",o.error.menuSpeed="The <menuSpeed> option must be an integer.",o.error.goToFrame_invalidFrame="goToFrame - Invalid frame name.",o.error.goToFrame_invalidPosition="goToFrame - Invalid frame position.",o.error.goToFrame_invalidObject="goToFrame - Invalid frame object.",o.error.goToFrame_menuItemNotFound="goToFrame - Menu item not found",o.error.storyMenuCreate_noItems="storyMenuCreate - No items to append to the menu.",o.error.buildMenu_notSet="<buildMenu> name not set for frame #__no__. Using the default instead.",o.error.storyFrame_elementNotFound='storyFrame: Invalid frame. Element "__name__" not found.',o.error.storyFrame_notValid='storyFrame: Invalid frame. Element "__element__" does not have a valid function of function object assigned.',o.error.needsRefresh="Properties need to be reset. Scroll from __start__ to __end__ and back in __time__ miliseconds.",o.error.invalidContent="Invalid content. The page must have a vertical scroll bar.",o.status.setOptions="Set options:",o.status.storyMenuCreate_init="storyMenuCreate - Before.",o.status.storyMenuCreate_end="storyMenuCreate - After.",o.status.storyGuideCreate_init="storyGuideCreate - Before.",o.status.storyGuideCreate_end="storyGuideCreate - After.",o.status.storyFrame_init='storyFrame "__u__" - Before.',o.status.storyFrame_end='storyFrame "__u__" - After.',o.status.frameTopOverwritten="The <frameTop> was overwritten to adapt to the guide menu.",o.const.storyline="Storyline",o.const.refreshAfter=200,o.const.dataTargetFrame="targetFrame",o.const.dataFrameInfo="frameInfo",o.const.dataFrameName="frameName",o.const.dataFramePosition="framePosition",o.const.frameNumber="Frame #",o.const.menuClass="storyline-menu",o.const.menuItemClass="storyline-menu-item";var s=console&&"function"==typeof console.log?function(e,s){void 0===s&&(s=n.debug);var l=0,d=0,c=0,m=["#FFFFFF","#00FFFF","#FF5555"],f="";if(t.each(n,function(e,t){t===s&&(l=c,f=m[c]),t===a.logLevel&&(d=c),c++}),l<d)return!1;switch(s){case n.debug:console.log(o.const.storyline+": ",e);break;case n.info:void 0!==console.info?console.info(o.const.storyline+": ",e):console.log(o.const.storyline+"["+s+"]: ",e);break;case n.error:void 0!==console.error?console.warn(o.const.storyline+": ",e):console.log(o.const.storyline+"["+s+"]: ",e)}return a.guide&&(void 0===r.guideConsole&&(r.guideConsole=t('<div rel="console" style="background:none repeat scroll 0 0 rgba(58,58,58,0.9);bottom:115px;color:#FFFFFF;font-family:monospace;font-size:12px;line-height:14px;padding:20px;position:fixed;right:40px;width:calc(25% - 80px);min-width:300px;z-index:10001;overflow-x:hidden;overflow-y:auto;word-wrap:break-word;min-height:20px;max-height:200px;"><b style="text-transform:uppercase;">'+o.const.storyline+" log</b><br/></div>"),i.body.append(r.guideConsole)),r.guideConsole.html(r.guideConsole.html()+'<b style="color:'+f+';">&amp;&gt;</b>&nbsp;<span style="color:'+f+';">'+("string"!=typeof e?JSON.stringify(e):"<i>"+e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>")+"</i>")+"</span><br/>")),!1}:function(){return!1},l=function(e){if("object"==typeof e){var t=0;for(var r in e)e.hasOwnProperty(r)&&t++;return t}return 0};if("boolean"!=typeof a.ignoreWarnings&&(a.ignoreWarnings=!0),void 0!==r.storylineScroll)return s(o.error.singleton,n.error);if(0===l(a.frames))return s(o.error.frames,n.error);if("boolean"!=typeof a.guide&&(a.guide=!0,s(o.error.guide,n.error)),"number"!=typeof a.tolerance){if(s(o.error.tolerance,n.error),!a.ignoreWarnings)return!1;a.tolerance=20}else a.tolerance=Math.abs(parseInt(a.tolerance));if(!1!==a.buildMenu&&"object"!=typeof a.buildMenu){if(s(o.error.buildMenu,n.error),!a.ignoreWarnings)return!1;a.buildMenu=!1}if("number"!=typeof a.menuSpeed){if(s(o.error.menuSpeed,n.error),!a.ignoreWarnings)return!1;a.menuSpeed=1500}else a.menuSpeed=Math.abs(parseInt(a.menuSpeed));s(o.status.setOptions,n.info);var d=t.extend({},a);delete d.frames,s(d,n.info),window.setTimeout(function(){i.holder="fixed"===i.body.css("position")?i.body:t(window),t.extend(r,{screenHeight:i.holder.height(),screenWidth:i.holder.width(),documentHeight:i.holder.outerHeight(!0),readyForActions:!1,frameIterator:1,frameActiveStates:{},frameCenterStates:{},frameHeights:{},frameList:{},storyGuideObject:null,storyLineMenu:null,mostVisibleFrame:null,mostVisibleFrameV:null,frameTools:{goToFrame:function(e,l,d){var c="numeric"!=typeof l?a.menuSpeed:l,m="boolean"!=typeof d||d,f=null,u=null;switch(typeof e){case"string":t.each(r.frameList,function(r,n){if(void 0!==t(n).data(o.const.dataFrameInfo)&&t(n).data(o.const.dataFrameInfo)[o.const.dataFrameName]===e)return u=t(n),!1}),null!==u?f=u:s(o.error.goToFrame_invalidFrame+' "'+e+'".',n.error);break;case"number":t.each(r.frameList,function(r,n){if(void 0!==t(n).data(o.const.dataFrameInfo)&&t(n).data(o.const.dataFrameInfo)[o.const.dataFramePosition]===e)return u=t(n),!1}),null!==u?f=u:s(o.error.goToFrame_invalidPosition+' "'+e+'".',n.error);break;case"object":void 0!==t(e).data(o.const.dataFrameInfo)?f=e:s(o.error.goToFrame_invalidObject,n.error);break;default:s(o.error.goToFrame_invalidFrame,n.error)}if(null!==f){if(m&&i.holder.scrollTop()!==t(f).offset().top){var h=t(f).offset().top;h>=a.frameTop&&(h-=a.frameTop),t("html,body").stop().animate({scrollTop:h},c)}if(a.buildMenu&&null!==r.storyLineMenu){var p=null;t.each(r.storyLineMenu.children(),function(e,r){"object"==typeof t(r).data(o.const.dataTargetFrame)&&(t(r).data(o.const.dataTargetFrame).data(o.const.dataFrameInfo)===t(f).data(o.const.dataFrameInfo)?null===p&&(!t(r).hasClass("active")&&t(r).addClass("active"),p=t(r)):t(r).hasClass("active")&&t(r).removeClass("active"))}),null!==p?a.guide&&(t(r.storyLineMenu).children().attr("title","."+o.const.menuItemClass),t(p).attr("title","."+o.const.menuItemClass+".active")):s(o.error.goToFrame_menuItemNotFound,n.error),r.storyLineMenu.css("display",r.readyForActions?"block":"none")}}}}}),t.fn.extend(r.frameTools);var e=function(){s(o.status.storyGuideCreate_init),r.storyGuideObject=t('<div style="position:fixed;top:50%;height:5px;width:100%;background:rgba(253,219,39,0.8);z-index:10000;"></div><div rel="window" style="position:fixed;bottom:40px;right:40px;height:75px;width:calc(100% - 80px);background:rgba(194,194,194,0.5);z-index:10000;"><div rel="slider" style="position:absolute;top:0;left:0;height:100%;width:'+r.screenHeight/r.documentHeight*100+'%;box-shadow:0px 0px 0px 1px rgba(253,219,39,0.8);background:rgba(255,255,255,0.2);z-index:10001;"><div rel="cursor" style="position:absolute;top:0;left:50%;height:100%;width:2px;background:rgba(253,219,39,0.9);z-index:10002;"></div></div><div rel="slides"></div></div>');var e="";t.each(r.frameHeights,function(t,o){e+='<div rel="frame" key="'+t+'" style="position:absolute;z-index:10000;background:rgba('+(r.frameActiveStates[t]?"0,177,210":"58,58,58")+",0.8);left:"+o.top/r.documentHeight*100+"%;width:"+o.height/r.documentHeight*100+'%;height:100%;font-family:Oswald,Arial,sans-serif;font-size:15px;color:#fff;font-size:2em;text-align:center;line-height:75px;box-shadow:1px 0px 0 0px rgba(255,255,255,1) inset;">'+t+"</div>"}),t("[rel=slides]",r.storyGuideObject).append(t(e)),t("html").append(r.storyGuideObject),s(o.status.storyGuideCreate_end)},d=function(){r.framesLoaded&&a.buildMenu&&(r.mostVisibleFrame=null,r.mostVisibleFrameV=null,null!==r.storyLineMenu&&(t.each(r.frameCenterStates,function(e,t){t=Math.abs(t),(null===r.mostVisibleFrame||t<r.mostVisibleFrameV)&&(r.mostVisibleFrame=parseInt(e),r.mostVisibleFrameV=t)}),null!==r.mostVisibleFrame&&r.frameTools.goToFrame(r.mostVisibleFrame,null,!1)))},c=function(e,c){s(o.status.storyFrame_init.replace("__u__",e));var m=e,f=t(e),u={onEnter:null,onLeave:null,onActive:null,scrollIntoView:a.scrollIntoView};if("function"==typeof c)u.onActive=c;else{if("object"!=typeof c)return void s(o.error.storyFrame_notValid.replace("__element__",e),n.error);u=t.extend(u,c)}t.each(f,function(e,o){r.frameList[l(r.frameList)+1]=t(o)});return function(e){var l=i.holder.scrollTop();t.each(f,function(i,d){var c={frameTop:t(d).offset().top-l,frameLeft:t(d).offset().left,frameWidth:t(d).width(),frameHeight:t(d).height(),screenWidth:r.screenWidth,screenHeight:r.screenHeight,frameBottom:r.screenHeight-t(d).offset().top-t(d).height()+l,frameRight:r.screenWidth-t(d).offset().left-t(d).width(),screenScrollTop:l,frameMiddleDistance:0,percent:{}};if(!t(d).data(o.const.dataFrameInfo)){var f=o.const.frameNumber+r.frameIterator;"object"==typeof a.buildMenu&&(void 0!==a.buildMenu[r.frameIterator-1]?f=a.buildMenu[r.frameIterator-1]:s(o.error.buildMenu_notSet.replace("__no__",r.frameIterator),n.warn)),t(d).data(o.const.dataFrameInfo,{framePosition:r.frameIterator,frameSelector:m,frameName:f}),r.frameIterator++}var h=c.frameBottom<=c.screenHeight-a.tolerance/2&&c.frameTop<=c.screenHeight-a.tolerance/2;if(c.percent.screenPlayed=l/(r.documentHeight-r.screenHeight)*100,h?(c.frameBottom>0?c.frameTop<0?c.percent.frameVisible=(c.screenHeight-c.frameBottom+a.tolerance/2)/c.frameHeight*100:c.percent.frameVisible=100:c.percent.frameVisible=(c.screenHeight-c.frameTop+a.tolerance/2)/c.frameHeight*100,c.percent.frameVisible=c.percent.frameVisible<0?0:c.percent.frameVisible>100?100:c.percent.frameVisible,middleDistance=c.frameTop+c.frameHeight/2+a.tolerance/2-r.screenHeight/2,middleDistance=middleDistance>c.screenHeight+a.tolerance?c.screenHeight+a.tolerance:middleDistance,c.frameMiddleDistance=middleDistance,c.percent.frameUnCentered=middleDistance/(c.screenHeight/2)*100,c.percent.frameUnCentered<=-100&&(c.percent.frameUnCentered=-100),c.percent.frameUnCentered>=100&&(c.percent.frameUnCentered=100),r.readyForActions&&"function"==typeof u.onActive&&u.onActive.call(t(d),c,e)):(c.percent.frameVisible=0,c.percent.frameUnCentered=-100),void 0!==r.frameActiveStates[t(d).data(o.const.dataFrameInfo)[o.const.dataFramePosition]]&&r.frameActiveStates[t(d).data(o.const.dataFrameInfo)[o.const.dataFramePosition]]===h||(h?"function"==typeof u.onEnter&&(u.onEnter.call(t(d),c,e),u.scrollIntoView&&window.setTimeout(()=>{t(d)[0].scrollIntoView({behavior:"smooth",block:"start"})},250)):r.readyForActions&&void 0!==r.frameActiveStates[t(d).data(o.const.dataFrameInfo)[o.const.dataFramePosition]]&&"function"==typeof u.onLeave&&u.onLeave.call(t(d),c,e),r.frameActiveStates[t(d).data(o.const.dataFrameInfo)[o.const.dataFramePosition]]=h),r.frameCenterStates[t(d).data(o.const.dataFrameInfo)[o.const.dataFramePosition]]=c.frameTop,r.frameHeights[t(this).data(o.const.dataFrameInfo)[o.const.dataFramePosition]]={height:t(this).height(),top:t(d).offset().top},r.framesLoaded&&a.guide){var p=t("[rel=frameguide]",t(d));0===p.length&&(p=t('<div rel="frameguide" style="transition:transform 0.1s linear;transition:cursor:pointer;position:absolute;z-index:10;top:40px;left:40px;max-width:250px;background:#00B1D2;color:#fff;padding:30px;font-size:14px;line-height:16px;font-family:Oswald,Arial,sans-serif;text-align:left;box-shadow:0px 10px 10px rgba(0,0,0,0.2);"></div>'),t(d).prepend(p)),p.css("display",r.readyForActions?"block":"none"),"static"===t(d).css("position")&&t(d).css("position","relative");var g='<i style="font-style:normal;position:absolute;top:0;left:0;width:0height:0;border-top:50px solid rgb(253, 219, 39);border-right:50px solid transparent;"></i><h4 style="color:#fff;font-weight: normal;font-size:18px;line-height:20px;margin:0 0 10px;">Frame info [$(this).data("frameInfo")]</h4>';t.each(t(d).data(o.const.dataFrameInfo),function(e,t){g+='<b style="color:#FDDB27;">'+e+'</b>: <i style="color:#fff;font-style:normal;">'+t+"</i><br/>"}),g+='<h4 style="color:#fff;font-weight: normal;font-size:18px;line-height:20px;margin:10px 0;">Frame coords [first callback arg.]</h4>',t.each(c,function(e,r){if("object"==typeof r){var o="";t.each(r,function(e,t){o+='<br/>&nbsp;&nbsp;&nbsp;<b style="color:#FDDB27;">'+e+'</b>=<i style="color:#fff;font-style:normal;">'+t.toFixed(2)+"%</i>"}),r=o}g+='<b style="color:#FDDB27;">'+e+'</b>: <i style="color:#fff;font-style:normal;">'+r+"</i><br/>"}),p.html(g)}}),d(),r.framesLoaded&&a.guide&&function(e){if(null===r.storyGuideObject)return!1;t("[rel=slider]",r.storyGuideObject).css({left:e/r.documentHeight*100+"%",width:r.screenHeight/r.documentHeight*100+"%"}),t.each(t("[rel=slides] [rel=frame]",r.storyGuideObject),function(e,o){t(o).css({left:r.frameHeights[t(o).attr("key")].top/r.documentHeight*100+"%",width:r.frameHeights[t(o).attr("key")].height/r.documentHeight*100+"%",background:"rgba("+(r.frameActiveStates[t(this).attr("key")]?"0,177,210":"58,58,58")+",0.8)"})})}(l),r.screenHeight=i.holder.height(),r.screenWidth=i.holder.width(),r.documentHeight=i.holder.is("body")?i.holder[0].scrollHeight:t("html")[0].scrollHeight}};r.framesLoaded=!1,t.each(a.frames,function(e,r){t(e).length>0?i.holder.scroll(c(e,r)):s(o.error.storyFrame_elementNotFound.replace("__name__",e),n.error)}),r.framesLoaded=!0,t(window).resize(function(){i.holder.trigger("scroll")}),i.holder.change(function(){t(this).trigger("scroll")}),i.holder.trigger("scroll"),!1!==a.buildMenu&&(s(o.status.storyMenuCreate_init),!1!==a.buildMenu&&(r.storyLineMenu=t('<div class="'+o.const.menuClass+'" '+(a.guide?'style="position:fixed;z-index: 11;top:0;left:0;width:100%;min-height:52px;text-align:center;box-shadow:0px 4px 0px rgba(253,219,39,0.5);background:rgba(253,219,39,1);" title=".'+o.const.menuClass+'"':"")+"></div>"),a.guide&&(s(o.status.frameTopOverwritten,n.info),a.frameTop=53),t.each(r.frameList,function(e,n){var i=t(n);if(void 0===i.data(o.const.dataFrameInfo))return!1;framePosition=i.data(o.const.dataFrameInfo)[o.const.dataFramePosition],frameName=i.data(o.const.dataFrameInfo)[o.const.dataFrameName],r.storyLineMenuItem=t('<div class="'+o.const.menuItemClass+'" '+(a.guide?'style="display:inline-block;height:52px;line-height:52px;font-size:18px;font-family:Oswald,Arial,sans-serif;color:#333;cursor:pointer;font-weight:normal;min-width:25px;padding:0 10px;margin:0;text-transform:capitalize;background:transparent;" title=".'+o.const.menuItemClass+'"':"")+' frame-pos="'+framePosition+'" frame-name="'+frameName+'">'+frameName+"</div>").data(o.const.dataTargetFrame,i).click(function(){t(this).goToFrame(i)}),r.storyLineMenu.append(r.storyLineMenuItem)}),r.storyLineMenu.children().length?(i.body.append(r.storyLineMenu),a.guide&&(r.storyLineMenu.prepend('<a class="logo" href="https://github.com/markjivko/storyline"></a>'),i.body.append(t('<style type="text/css">.'+o.const.menuItemClass+".active, ."+o.const.menuItemClass+":active, ."+o.const.menuItemClass+':hover {color:#000 !important;box-shadow:0px 4px 0px #00B1D2;}[rel="frameguide"]:hover {transform: scale(1.1);}</style>')))):(r.storyLineMenu=null,s(o.error.storyMenuCreate_noItems,n.error))),s(o.status.storyMenuCreate_end),null!==r.storyLineMenu&&null!==r.mostVisibleFrame||d()),r.documentHeight<=r.screenHeight?(null!==r.storyGuideObject&&t(r.storyGuideObject).css({opacity:0}),setTimeout(function(){var l=i.holder.scrollTop(),d=l+1;i.holder[0].scrollHeight+i.holder.scrollTop()>=i.holder.height()&&(d=l-1),s(o.error.needsRefresh.replace("__start__",l).replace("__end__",d).replace("__time__",10),n.info),t("html,body").stop().animate({scrollTop:d},5,function(){t(this).is("body")&&t("html,body").stop().animate({scrollTop:l},5,function(){t(this).is("body")&&(null!==r.storyGuideObject&&t(r.storyGuideObject).animate({opacity:1},200),r.documentHeight<=r.screenHeight?(s(o.error.invalidContent,n.error),i.holder.unbind("scroll"),t("[rel=frameguide]").remove(),t(r.storyGuideObject).remove(),t(r.storyLineMenu).remove(),t(r.guideConsole).css({background:"#000",maxHeight:"275px",bottom:"25px"})):(r.readyForActions=!0,a.guide&&e()))})})},o.const.refreshAfter)):(r.readyForActions=!0,a.guide&&e(),i.holder.trigger("scroll"))},100)}});